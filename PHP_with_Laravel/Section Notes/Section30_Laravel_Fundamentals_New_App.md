# Section 30 Creating New App

**Policy**

- Policies are classes that organize authorization logic around a particular model or resource. For example, if your application is a blog, you may have a App\Models\Post model and a corresponding App\Policies\PostPolicy to authorize user actions such as creating or updating posts.

```php
php artisan make:policy PostPolicy --model=Post
```

> The make:policy command will generate an empty policy class. If you would like to generate a class with example policy methods related to viewing, creating, updating, and deleting the resource, you may provide a --model option when executing the command:

**Policy Methods**

- Once the policy class has been registered, you may add methods for each action it authorizes. For example, let's define an update method on our PostPolicy which determines if a given App\Models\User can update a given App\Models\Post instance.

- The update method will receive a User and a Post instance as its arguments, and should return true or false indicating whether the user is authorized to update the given Post. So, in this example, we will verify that the user's id matches the user_id on the post:

```php
use App\Models\Post;
use App\Models\User;
use Illuminate\Auth\Access\Response;

/**
 * Determine if the given post can be updated by the user.
 *
 * @param  \App\Models\User  $user
 * @param  \App\Models\Post  $post
 * @return \Illuminate\Auth\Access\Response
 */
 public function update(User $user, Post $post)
    {
       return $user->id === $post->user_id;
    }

```

> in the postcontroller:

```php
public function edit(Post $post)
    {
        $this->authorize('update', $post);
        return view('admin.posts.edit', ['post'=>$post]);


    }

```

**Paginator**

- The paginate method automatically takes care of setting the query's "limit" and "offset" based on the current page being viewed by the user. By default, the current page is detected by the value of the page query string argument on the HTTP request. This value is automatically detected by Laravel, and is also automatically inserted into links generated by the paginator.

```php
/// This only shows 5 sets of data per page
$posts = auth()->user()->posts()->paginate(5);

```

- **WORK FLOW**

- create proj setup template setup database setup Authentication

**Middleware Route**

- Gets Authentication before proceding to route

```php

 Route::middleware('auth')->group(function(){

    Route::get('/admin', [App\Http\Controllers\AdminsController::class, 'index'])->name('admin.index');

```

});

**Factory with relation**

```

$ php artisan make:factory PostFactory --model=Post

```

```php

<?php

namespace Database\Factories;

use Illuminate\Database\Eloquent\Factories\Factory;

/**
 * @extends \Illuminate\Database\Eloquent\Factories\Factory<\App\Models\Post>
 */
class PostFactory extends Factory
{
    /**
     * Define the model's default state.
     *
     * @return array
     */
    public function definition()
    {
        return [

            'title' => $this->faker->sentence,
            'body' => $this->faker->sentence,
            'post_image' => $this->faker->imageUrl('900','300'),
            //
        ];
    }
}


```

```php

<?php

namespace Database\Seeders;

use Illuminate\Database\Console\Seeds\WithoutModelEvents;
use Illuminate\Database\Seeder;

use App\Models\Post;
use App\Models\User;

class DatabaseSeeder extends Seeder
{
    /**
     * Seed the application's database.
     *
     * @return void
     */
    public function run()
    {

      $user = User::factory(2)
        ->has(Post::factory())
        ->create();




    }
}

```

**CRUD WORKFLOW**

- [x] CREATE

```php


    public function store(Request $request)
    {

       $input = $request->validate([
            'title' => 'required',
            'post_image' => 'required',
            'body' => 'required',

        ]);

        auth()->user()->posts()->create($input);
        session()->flash('post-create-message', 'Post was Created');
        return redirect()->route('post.view');


    }


```

- [x] READ

- pass the post model to home controller to pass in Post data

```php


<?php

namespace App\Http\Controllers;

use Illuminate\Http\Request;
use App\Models\Post;
class HomeController extends Controller
{
    /**
     * Create a new controller instance.
     *
     * @return void
     */
    public function __construct()
    {
        $this->middleware('auth');
    }

    /**
     * Show the application dashboard.
     *
     * @return \Illuminate\Contracts\Support\Renderable
     */
    public function index()
    {

       $posts = Post::all();
        return view('home', ['posts' => $posts]);
    }
}



```

- Go to home view and display the data according to the card

```php


 @foreach ($posts as $post)

      <!-- Blog Post -->
      <div class="card mb-4">
        <img class="card-img-top" src="{{$post->post_image}}" alt="Card image cap">
        <div class="card-body">
          <h2 class="card-title">{{$post->title}}</h2>
          <p class="card-text">{{$post->body}}</p>
          <a href="{{$post->user_id}}" class="btn btn-primary">Read More &rarr;</a>
        </div>
        <div class="card-footer text-muted">
          {{$post->created_at->diffForHumans()}}
          <a href="#">Start Bootstrap</a>
        </div>
      </div>

      @endforeach

```

- [x] UPDATE

```php

```

- [x] DELETE

```php

    public function destroy(Post $post)
    {
       $post->delete();
       Session::flash('message', 'Post was deleted');
       return back();


    }
```
